<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Threats to validity – Online experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/experiment_setup.html" rel="next">
<link href="../chapters/power.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../custom.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/threats_to_validity.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Threats to validity</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Online experiments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/stats_of_online_experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The stats of online experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/threats_to_validity.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Threats to validity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/experiment_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Experiment setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/lemmas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lemmas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/stats_foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Statistics foundations</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#selection-bias" id="toc-selection-bias" class="nav-link active" data-scroll-target="#selection-bias"><span class="header-section-number">3.0.1</span> Selection bias</a></li>
  <li><a href="#threats-to-reliability" id="toc-threats-to-reliability" class="nav-link" data-scroll-target="#threats-to-reliability"><span class="header-section-number">3.1</span> Threats to reliability</a></li>
  <li><a href="#threats-to-internal-validity" id="toc-threats-to-internal-validity" class="nav-link" data-scroll-target="#threats-to-internal-validity"><span class="header-section-number">3.2</span> Threats to internal validity</a>
  <ul class="collapse">
  <li><a href="#misc-effects-some-of-them-relevant-only-for-field-experiments" id="toc-misc-effects-some-of-them-relevant-only-for-field-experiments" class="nav-link" data-scroll-target="#misc-effects-some-of-them-relevant-only-for-field-experiments"><span class="header-section-number">3.2.1</span> Misc effects (some of them relevant only for field experiments)</a></li>
  <li><a href="#interference" id="toc-interference" class="nav-link" data-scroll-target="#interference"><span class="header-section-number">3.2.2</span> Interference</a></li>
  <li><a href="#interaction-effects" id="toc-interaction-effects" class="nav-link" data-scroll-target="#interaction-effects"><span class="header-section-number">3.2.3</span> Interaction effects</a></li>
  <li><a href="#non-representative-users" id="toc-non-representative-users" class="nav-link" data-scroll-target="#non-representative-users"><span class="header-section-number">3.2.4</span> Non-representative users</a></li>
  <li><a href="#survivor-bias" id="toc-survivor-bias" class="nav-link" data-scroll-target="#survivor-bias"><span class="header-section-number">3.2.5</span> Survivor bias</a></li>
  <li><a href="#novelty-and-learning-effects" id="toc-novelty-and-learning-effects" class="nav-link" data-scroll-target="#novelty-and-learning-effects"><span class="header-section-number">3.2.6</span> Novelty and learning effects</a></li>
  <li><a href="#sample-ratio-mismatch" id="toc-sample-ratio-mismatch" class="nav-link" data-scroll-target="#sample-ratio-mismatch"><span class="header-section-number">3.2.7</span> Sample ratio mismatch</a></li>
  <li><a href="#attrition" id="toc-attrition" class="nav-link" data-scroll-target="#attrition"><span class="header-section-number">3.2.8</span> Attrition</a></li>
  <li><a href="#imperfect-compliance" id="toc-imperfect-compliance" class="nav-link" data-scroll-target="#imperfect-compliance"><span class="header-section-number">3.2.9</span> ## Imperfect compliance</a></li>
  </ul></li>
  <li><a href="#treats-to-external-validity" id="toc-treats-to-external-validity" class="nav-link" data-scroll-target="#treats-to-external-validity"><span class="header-section-number">3.3</span> Treats to external validity</a>
  <ul class="collapse">
  <li><a href="#budget-effects-in-ads" id="toc-budget-effects-in-ads" class="nav-link" data-scroll-target="#budget-effects-in-ads"><span class="header-section-number">3.3.1</span> Budget effects in Ads</a></li>
  <li><a href="#feedback-loops-from-personalisation" id="toc-feedback-loops-from-personalisation" class="nav-link" data-scroll-target="#feedback-loops-from-personalisation"><span class="header-section-number">3.3.2</span> Feedback loops from personalisation</a></li>
  <li><a href="#day-of-week-effects" id="toc-day-of-week-effects" class="nav-link" data-scroll-target="#day-of-week-effects"><span class="header-section-number">3.3.3</span> Day-of-week effects</a></li>
  <li><a href="#seasonality" id="toc-seasonality" class="nav-link" data-scroll-target="#seasonality"><span class="header-section-number">3.3.4</span> Seasonality</a></li>
  <li><a href="#differences-in-time-to-action-between-users" id="toc-differences-in-time-to-action-between-users" class="nav-link" data-scroll-target="#differences-in-time-to-action-between-users"><span class="header-section-number">3.3.5</span> Differences in time-to-action between users</a></li>
  <li><a href="#consent" id="toc-consent" class="nav-link" data-scroll-target="#consent"><span class="header-section-number">3.3.6</span> Consent</a></li>
  <li><a href="#heterogeneous-treatment-effects" id="toc-heterogeneous-treatment-effects" class="nav-link" data-scroll-target="#heterogeneous-treatment-effects"><span class="header-section-number">3.3.7</span> Heterogeneous treatment effects</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">3.4</span> Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-threats-to-validity" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Threats to validity</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>todo: - Integrate Shadish, Cook, and Campbell (2002) Experimental and quasi-experimental designs for causal inference… (cited in athey2017econometrics)</p>
<ul>
<li><p>For experiment results to be trustworthy, they need to be reliable, have high internal validity, and high external validity across time.</p></li>
<li><p>Reliability is about reproducibility of our results and the extent to which a rerun of the exact same experiment would lead to the same result. It’s about the stability of measurements and the replicability of the work.</p></li>
<li><p>Internal validity is about the extent to which the treatment effect estimate of our experiment reflects the cause and effect relationship of interest instead of being influenced by other factors. This is all about the design of the experiment.</p></li>
<li><p>External validity is about the extent to which our experiment results generalise both across different populations and across time. Results don’t usually generalise across populations (a feature may work well in one country but not in another), which isn’t a problem because we can (and usually should!) just run the experiment separately for different markets. Traditional experiments do, howerver, assume that experiments generalise over time, in that we think that the effect we estimate during the experiment period will be persistent – i.e.&nbsp;we think that the long-term effect of a change will be the same as the short-term effect.</p></li>
<li><p>In my mind, some of the threats listed below, such as learning effects, could be listed as threats to either internal or external validity. I list them where I think they make most sense given the definitions, but one could argue about that and some authors make different choices – what matters is that you think about them when designing an experiment!</p></li>
<li><p>Consider integrating <span class="citation" data-cites="king2006dangers">King and Zeng (<a href="#ref-king2006dangers" role="doc-biblioref">2006</a>)</span>, section 3.2 onwards, types of biases:</p></li>
</ul>
<ol type="1">
<li>Omitted variable bias</li>
<li>Posttreatment bias (including variables in X that are result of T)</li>
<li>Interpolation bias ()</li>
<li>Extrapolation bias</li>
</ol>
<p><strong>Violations of SUTVA</strong></p>
<ul>
<li><p>SUTVA will be violated if there are network effects: if the behaviour of units is mutually dependent. For instance: if my wife and I both use an online photo-sharing service and my wife sees a new feature that we both like while I’m in the control group, we might stil share the same number of family photos but start sharing them all on her account instead of mine. This creates an artificial treatment effect because if I had also had access to the new feature, we might not have changed our behaviour at all, while, during the experiment, her sharing volume went up while mine went down, suggesting the existent of a positive effect.</p></li>
<li><p>Another case where the no interference assumption can be violated is in the form of general equilibrium effects. A classic example is the effect of further education: the effect of my doing a PhD in statistics on my earnings while nobody else changes their behaviour (the partial-equilibrium effect) is surely different from the outcome of my earnings if suddenly everyone decided to do a PhD in statistics (the general-equilibrium effect).</p></li>
<li><p>The two violations capture the two different ways interference can lead to incorrect results: interference can happen and bias our results either during the experiment (threat to internal validity) or once the feature is fully rolled out (threat to external validity). In either case, the treatment of some unit has an externality on other units.</p></li>
<li><p>Another way in which this aspect of SUTVA can be violated is when treatments are administered in different ways, e.g.&nbsp;by either giving patients medication or asking them to take the medication themselves.</p></li>
</ul>
<section id="selection-bias" class="level3" data-number="3.0.1">
<h3 data-number="3.0.1" class="anchored" data-anchor-id="selection-bias"><span class="header-section-number">3.0.1</span> Selection bias</h3>
<p>Common types of selection bias in data science:</p>
<ul>
<li><p>The vast search effect (using the data to answer many questions will eventually reveal something interesting by mere chance – if 20,000 people flip a coin 10 times, some will have 10 straight heads)</p></li>
<li><p>Nonrandom sampling</p></li>
<li><p>Cherry-picking data</p></li>
<li><p>Selecting specific time-intervals</p></li>
<li><p>Stopping experiments prematurely</p></li>
<li><p>Regression to the mean (occurs in settings where we measure outcomes repeatedly over time and where luck and skill combine to determine outcomes, since winners of one period will be less lucky next period and perform closer to the mean performer)</p></li>
</ul>
<p>Ways to guard against selection bias:</p>
<ul>
<li>have one or many holdout datasets to confirm your results.</li>
</ul>
</section>
<section id="threats-to-reliability" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="threats-to-reliability"><span class="header-section-number">3.1</span> Threats to reliability</h2>
</section>
<section id="threats-to-internal-validity" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="threats-to-internal-validity"><span class="header-section-number">3.2</span> Threats to internal validity</h2>
<ul>
<li>Internal validity refers to the ability of a study to measure the causal effect within the study population.</li>
</ul>
<section id="misc-effects-some-of-them-relevant-only-for-field-experiments" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="misc-effects-some-of-them-relevant-only-for-field-experiments"><span class="header-section-number">3.2.1</span> Misc effects (some of them relevant only for field experiments)</h3>
<ul>
<li><p>Hawthorne effect: the treatment group works harder than normal.</p></li>
<li><p>John Henry effect: the comparison group competes with the treatment group.</p></li>
<li><p>Resentment and demoralising effect: not getting the treatment changes behaviour negatively.</p></li>
<li><p>Demand effect: treatment units more likely to do what they think is wanted from them.</p></li>
<li><p>Anticipation effect: control group changes behaviour in anticipation of future treatment.</p></li>
<li><p>Survey effect: being surveyed changes behaviour.</p></li>
</ul>
</section>
<section id="interference" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="interference"><span class="header-section-number">3.2.2</span> Interference</h3>
<ul>
<li><p>Basically, all violations to SUTVA</p></li>
<li><p>Interference can happen due to</p>
<ul>
<li><p>Network effects</p></li>
<li><p>Cannibalisation of resources in marketplaces</p></li>
<li><p>Shared resources (i.e.&nbsp;treatment slowing down site for everyone)</p></li>
</ul></li>
</ul>
</section>
<section id="interaction-effects" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="interaction-effects"><span class="header-section-number">3.2.3</span> Interaction effects</h3>
<ul>
<li><p>Users can be simultaneously part of multiple experiments, so that what we measure for reach of them is really the effect of the interaction of all of them. This means that, if only some features are implemented, the results after roll out could be different from those observed during the experiment period.</p></li>
<li><p>However, with large sample sizes, this should not generally be a problem because effects of different experiments average out between treatment and control group.</p></li>
<li><p>While the above may be true statistically, interaction effects can still lead to extremely poor user experiences (blue background interacted with blue font), which is why mature platforms aim to avoid them.</p></li>
</ul>
</section>
<section id="non-representative-users" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="non-representative-users"><span class="header-section-number">3.2.4</span> Non-representative users</h3>
<p>Possible scenarios:</p>
<ul>
<li><p>Our marketing department launches an add campaign and attracts a lot of unusual users to the site temporarily.</p></li>
<li><p>A competitor does the same and temporarily takes a ways users from our site.</p></li>
<li><p>Heavy-user bias: heavy users are more likely to be bucketed in an experiment, biasing the results relative to the overall effect of a feature. Depending on the context, this can be an issue.</p></li>
<li><p>Solution: run experiments for longer (thought this comes with opportunity costs, and will increase cookie churn)</p></li>
</ul>
</section>
<section id="survivor-bias" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="survivor-bias"><span class="header-section-number">3.2.5</span> Survivor bias</h3>
<ul>
<li>This is really just a version of the above: if you select only users that have used the product for some time, your sample is not representative of all users. The classic demonstration of survivor bias is <a href="https://en.wikipedia.org/wiki/Abraham_Wald">Abraham Wald’s</a> insight in WWII that you want to put extra armour where returning plans got hit the least, since it’s presumable the planes that got hit there that didn’t make it back.</li>
</ul>
<!-- ![Where would you put extra armour? By Martin Grandjean (vector), McGeddon (picture), Cameron Moll (concept) - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=102017718](../inputs/survivorship-bias.svg){width=50%} -->
</section>
<section id="novelty-and-learning-effects" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="novelty-and-learning-effects"><span class="header-section-number">3.2.6</span> Novelty and learning effects</h3>
<ul>
<li><p>Challenge: behaviour might change abruptly and temporarily in response to a new feature (novelty or “burn in” effect) or it might take a while for behaviour fully adapt to a new feature (learning effects). In both cases, the results from a relatively short experiment will not provide a representative picture of the long-run effects of a feature.</p></li>
<li><p>Examples: Increasing number of adds shows on Google led to increase in add revenue initially but then decrease of clicks in the long term because it increased add blindness <span class="citation" data-cites="hohnhold2015focusing">Hohnhold, O’Brien, and Tang (<a href="#ref-hohnhold2015focusing" role="doc-biblioref">2015</a>)</span></p></li>
<li><p>Solutions:</p>
<ul>
<li><p>Measure long-term effects (by running experiments for longer)</p></li>
<li><p>Have a “holdout” group of users that isn’t exposed to any changes for a pre-set period of time (a month, a quarter), to measure long-term effects</p></li>
<li><p>Estimate dynamic treatment effects to see the evolution of the treatment effect</p></li>
</ul></li>
</ul>
</section>
<section id="sample-ratio-mismatch" class="level3" data-number="3.2.7">
<h3 data-number="3.2.7" class="anchored" data-anchor-id="sample-ratio-mismatch"><span class="header-section-number">3.2.7</span> Sample ratio mismatch</h3>
</section>
<section id="attrition" class="level3" data-number="3.2.8">
<h3 data-number="3.2.8" class="anchored" data-anchor-id="attrition"><span class="header-section-number">3.2.8</span> Attrition</h3>
<p>Attrition is when, for some reason, we cannot collect endline data on some units.</p>
<p>It’s a problem because when it’s systematic rather than random, treatment and control group are no longer comparable, which is a threat to internal validity. (Even if the same number of people drop out, if they are different type, the problem is the same.) Also, it reduces sample size and thus power.</p>
<p>We can limit it if we promise access to the program to everyone (phase-in design), change the level of randomisation, and improve data collection.</p>
<p>In our analysis we should 1. Report the extent of attrition, 2. Check for differential attrition (between groups, and within groups based on observable characteristics), and 3. Determine the range of estimates given attrition using a selection model or bounds.</p>
<p>One method is to use Heckman’s selection model: we look at the characteristics of those who attrite, assume that they have the same outcomes as those with the same characteristics for which we have data, and then fill in their outcome variables accordingly.</p>
<p>Another method is to use bounds. There are two types.</p>
<p>Manski-Horowitz bounds: Lower bound: replace all missing values in treatment with the least favourable outcome value from the observed sample and replace all missing values in control with most favourable value in the observed sample. Upper bound created in a reverse way. Unless attrition is low and the outcome variable is tightly bounded, this tends to lead to very large bounds.</p>
<p>Lee bounds: We treat the estimate from the available data as an upper bound, and construct the lower bound by trimming from the sample with less attrition the observations that most contribute to the treatment effect.</p>
</section>
<section id="imperfect-compliance" class="level3" data-number="3.2.9">
<h3 data-number="3.2.9" class="anchored" data-anchor-id="imperfect-compliance"><span class="header-section-number">3.2.9</span> ## Imperfect compliance</h3>
<p>Partial complience</p>
<ul>
<li><p>Partial compliance occurs if, for some reason, some people in the treatment group are not treated or some people in the control group are.</p></li>
<li><p>It’s problematic because it reduces the difference in treatment exposure between treatment and control group (in the extreme, if they are equal, we learn nothing), and because they might make treatment takeup non-random.</p></li>
<li><p>A few things can help to limit the problem: make takeup easy and/or incentivise it, randomise at a higher level, and provide a treatment to everyone.</p></li>
<li><p>We can adjust our analysis by calculating LATE, either using the Wald estimator (ITT / difference in take-up between treatment and control groups) or 2SLS where we instrument the behaviour we want to encourage with the treatment dummy (and possibly other covariates).</p></li>
<li><p>Do not drop non-compliers or re-assign them to the control group – compliers and non-compliers are different so that dropping or reclassifying non-compliers would re-introduce self-selection into out two samples, which defeats the whole point of the randomisation.</p></li>
</ul>
<p>Defiers</p>
<ul>
<li><p>They are the opposite of compliers: they either take up the treatment because they were assigned to control or the other way around.</p></li>
<li><p>They might occur in an encouragement design if they overestimated the benefit of treatment and got discouraged by the information provided in the treatment.</p></li>
<li><p>They might make us significantly misinterpret the true effect (RRE page 303, or, better, MHE p 156).</p></li>
<li><p>We can deal with them only if they form an identifiable subgroup, in which case we can estimate the treatment effect on defiers and compliers separately and calculate an average treatment effect.</p></li>
</ul>
<p>In an experiment with one-sided non-compliance what does IV estimate 1. if there are no always-takers and 2. if there are not never-takers?</p>
<ul>
<li><p>In general, IV estimates LATE, the effect on compliers, and the treated consist of compliers and always-takers, while the non-treated consist of compliers and never-takers.</p></li>
<li><p>If there are no always-takers, the population of compliers is the same as the population of the treated, so that LATE = ATET.</p></li>
<li><p>If there are no never-takers, the population of compliers is the same as that of the untreated, so LATE = average treatment effect of the untreated.</p></li>
</ul>
</section>
</section>
<section id="treats-to-external-validity" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="treats-to-external-validity"><span class="header-section-number">3.3</span> Treats to external validity</h2>
<ul>
<li>External validity is concerned with whether the results from a study generalise to other contexts.</li>
</ul>
<section id="budget-effects-in-ads" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="budget-effects-in-ads"><span class="header-section-number">3.3.1</span> Budget effects in Ads</h3>
<ul>
<li>On an adds platform, a treatment might perform very well during an experiment in that it makes marketers launch more adds. But once scaled up may do less well because the increased traffic might exhaust marketer’s budgets, leading them to reduce adds launched.</li>
</ul>
</section>
<section id="feedback-loops-from-personalisation" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="feedback-loops-from-personalisation"><span class="header-section-number">3.3.2</span> Feedback loops from personalisation</h3>
<ul>
<li>Treatments might behave differently during experimentation and once they are scaled up if the performance of a feature is a function of the size of the audience it is exposed to (an example could be a recommendation algorithm, which performs better and better as it is being used more).</li>
</ul>
</section>
<section id="day-of-week-effects" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="day-of-week-effects"><span class="header-section-number">3.3.3</span> Day-of-week effects</h3>
<ul>
<li>See below</li>
</ul>
</section>
<section id="seasonality" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="seasonality"><span class="header-section-number">3.3.4</span> Seasonality</h3>
<ul>
<li><p>Seasonality comes in many forms: day of week effects, week of year effects, season effects, holiday effects, etc.</p></li>
<li><p>The challenge is that, potentially, user behaviour might differ on certain days or over certain time periods either because we get different users or because users change their behaviour.</p></li>
<li><p>Whether it is really a problem depends on the context. One aspect that is often forgotten here is that seasonality, first and foremost, is about a shift in levels – activity on LinkedIn might go down during the summer months. What we usually want to measure, however, is the difference between treatment and control units. Hence, if you don’t have reason to believe that the effect of the treatment is different during a particular season (e.g.&nbsp;because you think it’s additive), then seasonality might not be a problem for you.</p></li>
<li><p>Having said that, it’s actually quite likely that with either different users or different behaviour by the same users, users might react differently to featore on different days. So it really is a thread to external validity, and we thus should usually care about it.</p></li>
<li><p>Solution: design your experiment so as to take seasonality into account. E.g. run your experiment for at least one week to account for day of week effects (that’s generally a good idea), don’t run crucial experiments during the holiday season or on major holidays or discard data from such periods, etc.</p></li>
<li><p>What to take into account depends on your context. So understand the relevant seasonality for you (if you’re a travel app, consider seasonality of travel demand, if you’re an e-commerce site, consider seasonality of shopping behaviour)</p></li>
</ul>
</section>
<section id="differences-in-time-to-action-between-users" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="differences-in-time-to-action-between-users"><span class="header-section-number">3.3.5</span> Differences in time-to-action between users</h3>
<ul>
<li><p>Some users may engage with a new features immediately, others might take a while and then react differently to it.</p></li>
<li><p>When running experiments for a very short time, we might thus get a biased picture of the overall effect of the feature.</p></li>
<li><p>With this one, one could argue that it’s a threat to internal validity, too. But that depends on what whether we set out to measure the short or long-term causal effect in our study</p></li>
</ul>
</section>
<section id="consent" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="consent"><span class="header-section-number">3.3.6</span> Consent</h3>
<ul>
<li>If consent for experiment participation is required, then people who give consent may be different from those who don’t.</li>
</ul>
</section>
<section id="heterogeneous-treatment-effects" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="heterogeneous-treatment-effects"><span class="header-section-number">3.3.7</span> Heterogeneous treatment effects</h3>
<ul>
<li>Consent above is a specific manifestation of the underlying problem: heterogeneous treatment effects. Often, it is plausible that participants of an experiment are different from non-participants, since – in real life – sampling into the experiment population doesn’t happen at random. So, clearly defining who the full population of interest is, what population we can make inferences about from our experiment population, and understanding hte difference between the two is crucial.</li>
</ul>
</section>
</section>
<section id="resources" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="resources"><span class="header-section-number">3.4</span> Resources</h2>
<ul>
<li><p><a href="https://www.forbes.com/sites/quora/2015/06/19/when-should-ab-testing-not-be-trusted-to-make-decisions/">Forbes article on when not to trust your A/B tests</a></p></li>
<li><p><a href="https://towardsdatascience.com/ab-testing-when-external-validity-messes-with-your-results-888197b6bc7b">Dennis Meisner discussing threats to external validity</a></p></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-hohnhold2015focusing" class="csl-entry" role="listitem">
Hohnhold, Henning, Deirdre O’Brien, and Diane Tang. 2015. <span>“Focusing on the Long-Term: It’s Good for Users and Business.”</span> In <em>Proceedings of the 21th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining</em>, 1849–58.
</div>
<div id="ref-king2006dangers" class="csl-entry" role="listitem">
King, Gary, and Langche Zeng. 2006. <span>“The Dangers of Extreme Counterfactuals.”</span> <em>Political Analysis</em> 14 (2): 131–59.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/power.html" class="pagination-link" aria-label="Power">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Power</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/experiment_setup.html" class="pagination-link" aria-label="Experiment setup">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Experiment setup</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>